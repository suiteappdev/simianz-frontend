//region Imports
import {Outlet, Event} from '..'
//import t from 'exectimer'
//endregion

process.on('unhandledRejection', e => { throw e })

describe('Event', function() {

  it('sets name', () => {
    const name = 'foo'
    const event = new Event(name)
    expect(event.name).to.equal(name)
  })

})

describe('Outlet', function() {

  it('callbacks fire in the correct order', (done) => {

    const eventName = 'foo'
    const outlet = new Outlet
    const event = outlet.event(eventName)

    const beforeCb1 = sinon.spy()
    const beforeCb2 = sinon.spy()
    const runCb = sinon.spy()
    const afterCb1 = sinon.spy()
    const afterCb2 = sinon.spy()

    outlet.before('foo', async () => {
      beforeCb1()
    })

    outlet.before('foo', async () => {
      beforeCb2()
    })

    outlet.after('foo', async () => {
      afterCb1()
    })

    outlet.after('foo', async () => {
      afterCb2()
    })

    event.run({}, async () => {
      runCb()
    }).then(() => {
      beforeCb1.should.be.calledBefore(beforeCb2)
      beforeCb2.should.be.calledBefore(runCb)
      runCb.should.have.been.calledOnce
      afterCb1.should.be.calledAfter(runCb)
      afterCb2.should.be.calledAfter(afterCb1)
      done()
    })

  })

  it('callbacks fire in correct order', () => {

  })

})
